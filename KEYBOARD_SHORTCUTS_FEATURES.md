# 自定义键盘快捷键功能说明

## 功能概述

本文档详细介绍了在Md2Slide项目中实现的自定义键盘快捷键功能。该功能允许用户根据自己的习惯自定义编辑器中的快捷键，提高编辑效率。

## 实现的功能

### 1. 基础编辑功能快捷键
- **复制当前行**: `Ctrl+D` - 复制光标所在行到下一行
- **删除当前行**: `Ctrl+Shift+D` - 删除光标所在行
- **向上移动行**: `Alt+Up` - 将当前行向上移动一行
- **向下移动行**: `Alt+Down` - 将当前行向下移动一行
- **格式延续**: `Enter` - 在列表、引用、待办事项等格式后自动延续格式

### 2. 自定义快捷键设置
- 用户可以通过设置菜单中的"键盘快捷键"选项卡自定义快捷键
- 支持实时验证快捷键格式的有效性
- 检测并阻止快捷键冲突
- 提供重置为默认设置的选项

### 3. 现有快捷键增强
- 所有原有的快捷键功能得到保留
- 新增的快捷键功能与现有功能无缝集成
- 支持Windows和macOS系统的快捷键差异

## 技术实现

### 文件结构
```
src/
├── types/
│   └── keyboard.ts          # 快捷键类型定义和默认配置
├── services/
│   └── keyboardService.ts   # 快捷键管理服务
├── components/
│   ├── KeyboardShortcutsPanel.tsx  # 快捷键设置界面
│   └── HelpModal.tsx               # 帮助文档界面
└── App.tsx                  # 编辑器键盘事件处理
```

### 核心功能模块

#### 1. 类型定义 (keyboard.ts)
- `ShortcutConfig` 接口定义了所有可配置的快捷键
- `defaultShortcuts` 提供默认快捷键配置
- 支持多种修饰键组合 (Ctrl, Meta/Cmd, Shift, Alt)

#### 2. 快捷键服务 (keyboardService.ts)
- 实现 `KeyboardService` 接口
- 提供快捷键的获取、设置、验证和冲突检测功能
- 通过 localStorage 持久化存储用户配置
- 提供 `getActionForKeyboardEvent` 方法用于快捷键匹配

#### 3. 设置界面 (KeyboardShortcutsPanel.tsx)
- 提供直观的界面供用户修改快捷键
- 实时显示快捷键冲突警告
- 支持快捷键格式验证
- 提供重置所有快捷键到默认值的功能

#### 4. 编辑器集成 (App.tsx)
- 更新 `handleEditorKeyDown` 函数以支持自定义快捷键
- 保持向后兼容性，保留原有快捷键逻辑
- 通过 `keyboardService` 检查并执行自定义快捷键操作

## 使用方法

### 1. 使用预设快捷键
- 直接使用默认的快捷键组合即可享受增强的编辑功能
- 所有快捷键都在帮助文档中有详细说明

### 2. 自定义快捷键
1. 点击右上角的设置图标
2. 选择"键盘快捷键"选项卡
3. 点击想要修改的快捷键输入框
4. 按下新的快捷键组合
5. 系统会自动验证并保存设置

### 3. 恢复默认设置
- 在快捷键设置界面底部点击"恢复默认设置"按钮
- 所有快捷键将恢复到默认配置

## 设计原则

### 1. 向后兼容
- 保留所有原有的快捷键功能
- 新功能不会影响现有用户的使用习惯

### 2. 用户友好
- 提供清晰的错误提示和冲突警告
- 支持一键恢复默认设置
- 在帮助文档中更新了相关说明

### 3. 平台适配
- 考虑Windows和macOS系统的差异
- 使用适当的修饰键（如Ctrl vs Cmd）

### 4. 可扩展性
- 类型安全的设计便于添加新的快捷键功能
- 模块化的架构便于维护和扩展

## 测试验证

所有功能都经过以下测试验证：
- 快捷键功能的正确性
- 自定义设置的持久化存储
- 快捷键冲突检测的有效性
- 界面的用户友好性
- 与原有功能的兼容性

## 未来改进方向

- 添加快捷键导入/导出功能
- 支持快捷键分组管理
- 提供快捷键使用统计
- 支持更复杂的快捷键序列

## 解决的问题

1. **编辑效率提升**: 通过复制/删除行等功能显著提高编辑效率
2. **个性化定制**: 允许用户根据习惯自定义快捷键
3. **冲突解决**: 通过自定义功能避免与浏览器快捷键冲突
4. **用户体验**: 提供统一的设置入口，方便管理所有快捷键